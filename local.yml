--- 
- hosts: localhost
  connection: local
  become: true

  tasks:
    - name: traefik container
      community.docker.docker_container:
        name: traefik
        image: traefik:v3.0
        restart_policy: always
        recreate: true
        exposed_ports:
          - 80
          - 443
          - 8080
        volumes:
          - ~/.ansible/pull/{{ ansible_facts["nodename"] }}/traefik/traefik.toml:/etc/traefik/traefik.toml
          - ~/.ansible/pull/{{ ansible_facts["nodename"] }}/traefik/dynamic.toml:/etc/traefik/dynamic.toml

    - name: installs tailscale
      ansible.builtin.shell:
        cmd: |
          curl -fsSL https://tailscale.com/install.sh | sh

  roles:
    - role: hifis.unattended_upgrades
      vars:
        unattended_origins_patterns:
          - origin=Ubuntu,archive=${distro_codename}-security
          - origin=Ubuntu,a=${distro_codename}-updates
        systemd_timer_OnCalendar: "*:0/30"

    - role: dwsr.ansible_pull
      vars:
        ansible_pull_playbook: local.yml
        ansible_pull_inventory: none.yml
        ansible_pull_repo_url: git@github.com:legitcamper/homelab-proxy.git
